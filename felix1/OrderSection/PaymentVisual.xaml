<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:felix1.OrderSection"
             x:Class="felix1.OrderSection.PaymentVisual"
             BackgroundColor="#FFFFFF">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:BoolToColorConverter x:Key="BoolToColorConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="*, Auto"
          ColumnDefinitions="*, 30, *"
          Padding="20"
          RowSpacing="20">

        <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="15">
            <Frame BackgroundColor="#F5F5F5"
                   CornerRadius="10"
                   BorderColor="#FFE0E0E0"
                   HasShadow="True"
                   Padding="0">
                <VerticalStackLayout Spacing="10" Padding="15">

                    <Label Text="Detalles" FontAttributes="Bold" FontSize="20" TextColor="#005F8C" FontFamily="Inter"/>
                    <CollectionView x:Name="ItemsList" ItemsSource="{Binding Order.Items}" MaximumHeightRequest="125">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <VerticalStackLayout Margin="0,0,0,10">
                                    <Label Text="{Binding Article.Name}" 
                                               TextColor="#005F8C" 
                                               FontAttributes="Bold"
                                               FontFamily="Inter"/>

                                    <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="5">
                                        <Label Text="- " 
                                           Grid.Column="0"
                                           TextColor="#005F8C"
                                           FontFamily="Inter"
                                           VerticalOptions="Center"/>

                                        <Label Grid.Column="1"
                                               TextColor="#005F8C"
                                               FontFamily="Inter"
                                               VerticalOptions="Center">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding Quantity, StringFormat='{0:N0} x '}" 
                                                          TextColor="#005F8C"
                                                          FontFamily="Inter"/>
                                                    <Span Text="{Binding UnitPrice, StringFormat='{0:N2}'}" 
                                                      TextColor="#005F8C"
                                                      FontFamily="Inter"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <Label Text="{Binding TotalPrice, StringFormat='{0:N2}'}" 
                                           Grid.Column="2"
                                           TextColor="#005F8C"
                                           FontAttributes="Bold"
                                           HorizontalOptions="End"
                                           FontFamily="Inter"
                                           VerticalOptions="Center"/>
                                    </Grid>

                                </VerticalStackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <BoxView HeightRequest="1" BackgroundColor="#005F8C" Margin="0,10" />

                    <Grid ColumnDefinitions="Auto, *, Auto">
                        <Label Text="{Binding ItemsCount, StringFormat='Items x{0:N0}'}" 
                               Grid.Column="0" 
                               Grid.ColumnSpan="2"
                               TextColor="#005F8C" 
                               HorizontalOptions="Start"
                               FontFamily="Inter"/>


                        <Label Text="{Binding Subtotal, StringFormat='{0:N2}'}" 
                                   Grid.Column="2" 
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>

                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="{Binding TaxITBISLabel}" 
                                   TextColor="#005F8C"
                                   FontFamily="Inter"/>
                        <Label Text="{Binding TaxITBIS, StringFormat='{0:N2}'}" 
                                   Grid.Column="1"
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>

                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="{Binding TaxWaitersLabel}" 
                                   TextColor="#005F8C"
                                   FontFamily="Inter"/>
                        <Label Text="{Binding TaxWaiters, StringFormat='{0:N2}'}" 
                                   Grid.Column="1"
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>

                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="Total" 
                                   FontAttributes="Bold" 
                                   TextColor="#005F8C"
                                   FontFamily="Inter"/>
                        <Label Text="{Binding Total, StringFormat='{0:N2}'}" 
                                   Grid.Column="1"
                                   FontAttributes="Bold" 
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>

                    <BoxView HeightRequest="1" BackgroundColor="#005F8C" Margin="0,10" IsVisible="{Binding AnyPaymentMethodUsed}"/>

                    <Grid ColumnDefinitions="*, Auto" IsVisible="{Binding IsCashUsed}">
                        <Label Text="Efectivo:" 
                                   TextColor="#005F8C"
                                   FontFamily="Inter"/>
                        <Label Text="{Binding CashAmount, StringFormat='{0:N2}'}" 
                                   Grid.Column="1"
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>

                    <Grid ColumnDefinitions="*, Auto" IsVisible="{Binding IsTransferUsed}">
                        <Label Text="Transferencia:" 
                                   TextColor="#005F8C"
                                   FontFamily="Inter"/>
                        <Label Text="{Binding TransferAmount, StringFormat='{0:N2}'}" 
                                   Grid.Column="1"
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>

                    <Grid ColumnDefinitions="*, Auto" IsVisible="{Binding IsCardUsed}">
                        <Label Text="Tarjeta:" 
                                   TextColor="#005F8C"
                                   FontFamily="Inter"/>
                        <Label Text="{Binding CardAmount, StringFormat='{0:N2}'}" 
                                   Grid.Column="1"
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>

                    <Grid ColumnDefinitions="*, Auto" IsVisible="{Binding AnyPaymentMethodUsed}">
                        <Label Text="Total Pagado:" 
                                   FontAttributes="Bold" 
                                   TextColor="#005F8C"
                                   FontFamily="Inter"/>
                        <Label Text="{Binding TotalPayment, StringFormat='{0:N2}'}" 
                                   Grid.Column="1"
                                   FontAttributes="Bold" 
                                   TextColor="#005F8C" 
                                   HorizontalOptions="End"
                                   FontFamily="Inter"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <Frame IsVisible="{Binding IsCashUsed}"
                   BackgroundColor="White"
                   CornerRadius="10"
                   BorderColor="White"
                   HasShadow="True"
                   Padding="15">
                <VerticalStackLayout Spacing="8">
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="Total" 
                               FontAttributes="Bold" 
                               TextColor="#005F8C" 
                               FontSize="30"
                               FontFamily="Inter"/>
                        <Label Text="{Binding Total, StringFormat='{0:N2}'}" 
                               Grid.Column="1"
                               FontAttributes="Bold" 
                               FontSize="30" 
                               TextColor="#005F8C" 
                               HorizontalOptions="End"
                               FontFamily="Inter"/>
                    </Grid>
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="Devuelta" 
                               FontAttributes="Bold" 
                               TextColor="#005F8C" 
                               FontSize="30"
                               FontFamily="Inter"/>
                        <Label Text="{Binding ChangeAmount, StringFormat='{0:N2}'}" 
                               Grid.Column="1"
                               FontAttributes="Bold" 
                               FontSize="30" 
                               TextColor="#005F8C" 
                               HorizontalOptions="End"
                               FontFamily="Inter"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="0" Grid.Column="2" Spacing="15">
            <Label Text="Métodos de pago" 
                   FontAttributes="Bold" 
                   FontSize="20" 
                   TextColor="#005F8C"
                   FontFamily="Inter"/>

            <ScrollView Orientation="Vertical" VerticalScrollBarVisibility="Always">
                <VerticalStackLayout Spacing="15">
                    <HorizontalStackLayout Spacing="10">
                        <Button Text="Transferencia (F6)" 
                                WidthRequest="150"
                                HeightRequest="40" 
                                CornerRadius="8" 
                                FontSize="14" 
                                BackgroundColor="#005F8C" 
                                TextColor="White"
                                FontAttributes="Bold"
                                FontFamily="Inter"
                                Clicked="OnAddTransferClicked"/>

                        <Button Text="Tarjeta (F7)" 
                                WidthRequest="150"
                                HeightRequest="40" 
                                CornerRadius="8" 
                                FontSize="14" 
                                BackgroundColor="#005F8C" 
                                TextColor="White"
                                FontAttributes="Bold"
                                FontFamily="Inter"
                                Clicked="OnAddCardClicked"/>
                    </HorizontalStackLayout>

                    <StackLayout x:Name="ActivePaymentMethodsContainer" Spacing="10">
                    </StackLayout>
                </VerticalStackLayout>
            </ScrollView>

            <Label x:Name="PaymentSummaryLabel"
                   Text="Pagado: $0.00 / $0.00"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   FontFamily="Inter"/>
        </VerticalStackLayout>

        <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
      ColumnDefinitions="*, Auto"
      HorizontalOptions="Fill"
      VerticalOptions="Center"
      Margin="0,0,20,0">

            <Button 
            Grid.Column="1" 
            x:Name="chargeButton"
            Text="Charge"
            BackgroundColor="#005F8C"
            TextColor="White"
            FontAttributes="Bold"
            CornerRadius="8"
            WidthRequest="150"
            HeightRequest="40"
            HorizontalOptions="End"
            VerticalOptions="Center"
            FontFamily="Inter"
            Clicked="OnChargeClicked"/>
        </Grid>
    </Grid>
</ContentPage>