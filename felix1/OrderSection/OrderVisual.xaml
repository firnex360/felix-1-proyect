<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:syncfusion="clr-namespace:Syncfusion.Maui.DataGrid;assembly=Syncfusion.Maui.DataGrid"
             x:Class="felix1.OrderSection.OrderVisual"
             BackgroundColor="White"
             Title="OrderVisual">

    <Grid ColumnDefinitions="400,*"
          RowDefinitions="*">

        <!-- LEFT COLUMN with DataGrid + SearchBar -->
        <Grid Grid.Column="0"
              RowDefinitions="*,Auto"
              Margin="20">

            <!-- Full-height DataGrid -->
            <Frame Grid.Row="0"
                   CornerRadius="10"
                   Padding="0"
                   HasShadow="True"
                   BackgroundColor="#F3F3F3"
                   BorderColor="#F5F7FA"
                   VerticalOptions="Fill"
                   HorizontalOptions="Start"
                   MaximumWidthRequest="400">

                <syncfusion:SfDataGrid x:Name="listArticleDataGrid"
                                       ItemsSource="{Binding ListArticles}"
                                       VerticalOptions="Fill"
                                       HorizontalOptions="Fill"
                                       HeaderRowHeight="60"
                                       RowHeight="50"
                                       AutoGenerateColumnsMode="None"
                                       SortingMode="Single"
                                       AllowTriStateSorting="True"
                                       ColumnWidthMode="Auto"
                                       CellDoubleTapped="OnArticleCellDoubleTapped">

                    <syncfusion:SfDataGrid.EmptyView>
                        <Label Text="No hay registros"
                               TextColor="Black"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </syncfusion:SfDataGrid.EmptyView>

                    <syncfusion:SfDataGrid.DefaultStyle>
                        <syncfusion:DataGridStyle HeaderRowBackground="#005F8C"
                                                  HeaderRowTextColor="#F3F3F3"
                                                  RowTextColor="Black"
                                                  HeaderRowFontAttributes="Bold"/>
                    </syncfusion:SfDataGrid.DefaultStyle>

                    <syncfusion:SfDataGrid.Columns>
                        <syncfusion:DataGridTextColumn
                            MappingName="Name"
                            HeaderText="Nombre"
                            CellTextAlignment="Start"
                            HeaderTextAlignment="Start"
                            ColumnWidthMode="FitByCell"
                            MaximumWidth="300"/>

                        <syncfusion:DataGridNumericColumn
                            MappingName="PriPrice"
                            HeaderText="Precio"
                            Format="C2"
                            CellTextAlignment="End"
                            HeaderTextAlignment="End"
                            ColumnWidthMode="LastColumnFill"/>
                    </syncfusion:SfDataGrid.Columns>
                </syncfusion:SfDataGrid>
            </Frame>

            <!-- SearchBar BELOW the DataGrid -->
            <Frame Grid.Row="1"
                   Grid.Column="0"
                   BackgroundColor="#F3F3F3"
                   CornerRadius="10"
                   Padding="0"
                   HasShadow="False"
                   VerticalOptions="End"
                   HorizontalOptions="Start"
                   WidthRequest="360"
                   HeightRequest="40"
                   BorderColor="#FFE0E0E0"
                   Margin="0,10,0,0">

                <SearchBar x:Name="searchBar"
                           Placeholder="Buscar artÃ­culos..."
                           TextChanged="OnSearchBarTextChanged"
                           TextColor="#22223B"
                           PlaceholderColor="#A0AEC0"
                           BackgroundColor="Transparent"
                           CancelButtonColor="#4F8FCB"
                           FontSize="16"
                           Margin="8,0"
                           HeightRequest="40"
                           HorizontalOptions="Fill"/>
            </Frame>
        </Grid>

        <!-- RIGHT COLUMN -->
        <Grid Grid.Column="1"
              RowDefinitions="Auto,*,*"
              Margin="20,20,20,20">

            <!-- Toolbar for Order Actions -->
            <StackLayout Grid.Row="0"
                         Orientation="Horizontal"
                         Spacing="10"
                         Margin="0,0,0,10">
                
                <Button Text="Edit Qty (Enter)"
                        BackgroundColor="#005F8C"
                        TextColor="White"
                        Clicked="OnEditQuantityClicked"
                        FontSize="12"
                        Padding="8,4"/>
                
                <Button Text="+"
                        BackgroundColor="#28a745"
                        TextColor="White"
                        Clicked="OnIncreaseQuantityClicked"
                        FontSize="14"
                        WidthRequest="40"
                        Padding="4"/>
                
                <Button Text="-"
                        BackgroundColor="#dc3545"
                        TextColor="White"
                        Clicked="OnDecreaseQuantityClicked"
                        FontSize="14"
                        WidthRequest="40"
                        Padding="4"/>
                
                <Button Text="Remove"
                        BackgroundColor="#6c757d"
                        TextColor="White"
                        Clicked="OnRemoveItemClicked"
                        FontSize="12"
                        Padding="8,4"/>
            </StackLayout>

            <!-- Order Items DataGrid -->
            <Frame Grid.Row="1"
                   CornerRadius="10"
                   Padding="0"
                   HasShadow="True"
                   BackgroundColor="#F3F3F3"
                   BorderColor="#F5F7FA"
                   VerticalOptions="Fill"
                   HorizontalOptions="Fill"
                   Margin="0,0,0,10">

                <syncfusion:SfDataGrid x:Name="orderItemsDataGrid"
                                       ItemsSource="{Binding OrderItems}"
                                       VerticalOptions="Fill"
                                       HorizontalOptions="Fill"
                                       HeaderRowHeight="60"
                                       RowHeight="50"
                                       AutoGenerateColumnsMode="None"
                                       SortingMode="None"
                                       AllowTriStateSorting="True"
                                       ColumnWidthMode="Auto"
                                       SelectionMode="Single"
                                       NavigationMode="Row"
                                       AllowEditing="True"
                                       CellTapped="OnOrderItemCellTapped">

                    <syncfusion:SfDataGrid.EmptyView>
                        <Label Text="No hay articulos en la orden"
                               TextColor="Black"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </syncfusion:SfDataGrid.EmptyView>

                    <syncfusion:SfDataGrid.DefaultStyle>
                        <syncfusion:DataGridStyle HeaderRowBackground="#005F8C"
                                                  HeaderRowTextColor="#F3F3F3"
                                                  RowTextColor="Black"
                                                  HeaderRowFontAttributes="Bold"/>
                    </syncfusion:SfDataGrid.DefaultStyle>

                    <syncfusion:SfDataGrid.Columns>
                        <syncfusion:DataGridNumericColumn
                            MappingName="Quantity"
                            HeaderText="Cantidad"
                            CellTextAlignment="Center"
                            HeaderTextAlignment="Center"
                            AllowEditing="True"
                            ColumnWidthMode="FitByCell"
                            MaximumWidth="100"/>

                        <syncfusion:DataGridTextColumn
                            MappingName="ArticleName"
                            HeaderText="Nombre"
                            CellTextAlignment="Start"
                            HeaderTextAlignment="Start"
                            ColumnWidthMode="FitByCell"
                            MaximumWidth="200"/>

                        <syncfusion:DataGridNumericColumn
                            MappingName="UnitPrice"
                            HeaderText="Precio"
                            Format="C2"
                            CellTextAlignment="End"
                            HeaderTextAlignment="End"
                            ColumnWidthMode="FitByCell"
                            MaximumWidth="100"/>

                        <syncfusion:DataGridNumericColumn
                            MappingName="TotalPrice"
                            HeaderText="Precio Total"
                            Format="C2"
                            CellTextAlignment="End"
                            HeaderTextAlignment="End"
                            ColumnWidthMode="LastColumnFill"/>
                    </syncfusion:SfDataGrid.Columns>
                </syncfusion:SfDataGrid>
            </Frame>

            <Label Text="Row 2 Content"
                   Grid.Row="2"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"/>
        </Grid>
    </Grid>
</ContentPage>
