<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:syncfusion="clr-namespace:Syncfusion.Maui.DataGrid;assembly=Syncfusion.Maui.DataGrid"
             x:Class="felix1.OrderSection.OrderVisual"
             BackgroundColor="White"
             Title="OrderVisual">

    <Grid ColumnDefinitions="400,*"
          RowDefinitions="*">

        <!-- LEFT COLUMN with DataGrid + SearchBar -->
        <Grid Grid.Column="0"
              RowDefinitions="*,Auto"
              Margin="20">

            <!-- Full-height DataGrid -->
            <Frame Grid.Row="0"
                   CornerRadius="10"
                   Padding="0"
                   HasShadow="True"
                   BackgroundColor="#F3F3F3"
                   BorderColor="#F5F7FA"
                   VerticalOptions="Fill"
                   HorizontalOptions="Start"
                   MaximumWidthRequest="400">

                <syncfusion:SfDataGrid x:Name="listArticleDataGrid"
                                       ItemsSource="{Binding ListArticles}"
                                       VerticalOptions="Fill"
                                       HorizontalOptions="Fill"
                                       HeaderRowHeight="60"
                                       RowHeight="50"
                                       AutoGenerateColumnsMode="None"
                                       SelectionMode="Single"
                                       NavigationMode="Cell"
                                       ColumnWidthMode="Auto"
                                       CellTapped="OnArticleCellTapped">

                    <syncfusion:SfDataGrid.EmptyView>
                        <Label Text="No hay registros"
                               TextColor="Black"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </syncfusion:SfDataGrid.EmptyView>

                    <syncfusion:SfDataGrid.DefaultStyle>
                        <syncfusion:DataGridStyle HeaderRowBackground="#005F8C"
                                                  HeaderRowTextColor="#F3F3F3"
                                                  RowTextColor="Black"
                                                  HeaderRowFontAttributes="Bold"
                                                  SelectionBackground="#C7CFDD"
                                                  CurrentCellBorderColor="#C7CFDD"/>
                    </syncfusion:SfDataGrid.DefaultStyle>

                    <syncfusion:SfDataGrid.SortColumnDescriptions>
                        <syncfusion:SortColumnDescription ColumnName="Name"
                                                          SortDirection="Ascending"/>
                    </syncfusion:SfDataGrid.SortColumnDescriptions>

                    <syncfusion:SfDataGrid.Columns>
                        <syncfusion:DataGridTextColumn
                            x:Name="colName"
                            MappingName="Name"
                            HeaderText="Nombre"
                            CellTextAlignment="Start"
                            HeaderTextAlignment="Start"
                            ColumnWidthMode="FitByCell"
                            MaximumWidth="400"
                            AllowSorting="True"/>

                        <syncfusion:DataGridNumericColumn
                            MappingName="PriPrice"
                            HeaderText="Precio"
                            Format="C2"
                            CellTextAlignment="End"
                            HeaderTextAlignment="End"
                            ColumnWidthMode="LastColumnFill"/>
                    </syncfusion:SfDataGrid.Columns>
                </syncfusion:SfDataGrid>
            </Frame>

            <!-- SearchBar BELOW the DataGrid -->
            <Frame Grid.Row="1"
                   Grid.Column="0"
                   BackgroundColor="#F3F3F3"
                   CornerRadius="10"
                   Padding="0"
                   HasShadow="False"
                   VerticalOptions="End"
                   HorizontalOptions="Start"
                   WidthRequest="360"
                   HeightRequest="40"
                   BorderColor="#FFE0E0E0"
                   Margin="0,10,0,0">

                <SearchBar x:Name="searchBar"
                           Placeholder="Buscar artÃ­culos..."
                           TextChanged="OnSearchBarTextChanged"
                           TextColor="#22223B"
                           PlaceholderColor="#A0AEC0"
                           BackgroundColor="Transparent"
                           CancelButtonColor="#4F8FCB"
                           FontSize="16"
                           Margin="8,0"
                           HeightRequest="40"
                           HorizontalOptions="Fill"
                           SearchButtonPressed="OnSearchBarSearchButtonPressed"/>
            </Frame>
        </Grid>

        <!-- RIGHT COLUMN -->
        <Grid Grid.Column="1"
              RowDefinitions="Auto,*,*"
              Margin="20,20,20,20">

            <!-- Toolbar for Order Actions -->
            <StackLayout Grid.Row="0"
                         Orientation="Horizontal"
                         Spacing="10"
                         Margin="0,0,0,10">

                <Button Text="+"
                        BackgroundColor="#28a745"
                        TextColor="White"
                        Clicked="OnIncreaseQuantityClicked"
                        FontSize="14"
                        WidthRequest="40"
                        Padding="4"/>

                <Button Text="-"
                        BackgroundColor="#dc3545"
                        TextColor="White"
                        Clicked="OnDecreaseQuantityClicked"
                        FontSize="14"
                        WidthRequest="40"
                        Padding="4"/>

                <Button Text="Eliminar"
                        BackgroundColor="#6c757d"
                        TextColor="White"
                        Clicked="OnRemoveItemClicked"
                        FontSize="12"
                        Padding="8,4"/>

                <CheckBox x:Name="dueToPayCheckBox"
                          VerticalOptions="Center"
                          Color="#005F8C"/>

                <Label Text="Por cobrar"
                       FontSize="14"
                       TextColor="Black"
                       VerticalOptions="Center"/>
            </StackLayout>

            <!-- Order Items DataGrid -->
            <Frame Grid.Row="1"
                   CornerRadius="10"
                   Padding="0"
                   HasShadow="True"
                   BackgroundColor="#F3F3F3"
                   BorderColor="#F5F7FA"
                   VerticalOptions="Fill"
                   HorizontalOptions="Fill"
                   Margin="0,0,0,10">

                <syncfusion:SfDataGrid x:Name="orderItemsDataGrid"
                                       ItemsSource="{Binding OrderItems}"
                                       VerticalOptions="Fill"
                                       HorizontalOptions="Fill"
                                       HeaderRowHeight="60"
                                       RowHeight="50"
                                       AutoGenerateColumnsMode="None"
                                       SortingMode="None"
                                       AllowTriStateSorting="True"
                                       ColumnWidthMode="Auto"
                                       SelectionMode="Single"
                                       NavigationMode="Cell"
                                       AllowEditing="False"
                                       LostFocusBehavior="EndEditCurrentCell"
                                       EditTapAction="OnTap">

                    <syncfusion:SfDataGrid.EmptyView>
                        <Label Text="No hay articulos en la orden"
                               TextColor="Black"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </syncfusion:SfDataGrid.EmptyView>

                    <syncfusion:SfDataGrid.DefaultStyle>
                        <syncfusion:DataGridStyle HeaderRowBackground="#005F8C"
                                                  HeaderRowTextColor="#F3F3F3"
                                                  RowTextColor="Black"
                                                  HeaderRowFontAttributes="Bold"
                                                  SelectionBackground="#C7CFDD"
                                                  CurrentCellBorderColor="#C7CFDD"/>
                    </syncfusion:SfDataGrid.DefaultStyle>

                    <syncfusion:SfDataGrid.Columns>
                        <syncfusion:DataGridNumericColumn
                            MappingName="Quantity"
                            HeaderText="Cantidad"
                            Format="0"
                            CellTextAlignment="Center"
                            HeaderTextAlignment="Center"
                            AllowEditing="True"
                            ColumnWidthMode="FitByHeader"/>

                        <syncfusion:DataGridTextColumn
                            MappingName="ArticleName"
                            HeaderText="Nombre"
                            CellTextAlignment="Start"
                            HeaderTextAlignment="Start"
                            ColumnWidthMode="FitByCell"
                            MaximumWidth="800"/>

                        <syncfusion:DataGridNumericColumn
                            MappingName="UnitPrice"
                            HeaderText="Precio"
                            Format="C2"
                            CellTextAlignment="End"
                            HeaderTextAlignment="End"
                            ColumnWidthMode="FitByCell"
                            MaximumWidth="100"/>

                        <syncfusion:DataGridNumericColumn
                            MappingName="TotalPrice"
                            HeaderText="Precio Total"
                            Format="C2"
                            CellTextAlignment="End"
                            HeaderTextAlignment="End"
                            ColumnWidthMode="LastColumnFill"/>
                    </syncfusion:SfDataGrid.Columns>
                </syncfusion:SfDataGrid>
            </Frame>

            <!-- Order Summary -->
            <Frame Grid.Row="2"
                   CornerRadius="10"
                   Padding="15"
                   HasShadow="True"
                   BackgroundColor="#F8F9FA"
                   BorderColor="#E9ECEF"
                   Margin="0,0,0,0">

                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="25,25,25,40,Auto,50,Auto">

                    <!-- Subtotal -->
                    <Label Grid.Row="0"
                           Grid.Column="0"
                           Text="Subtotal:"
                           FontSize="14"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           TextColor="Black"/>
                    <Label Grid.Row="0"
                           Grid.Column="1"
                           x:Name="subtotalLabel"
                           Text="$0.00"
                           FontSize="14"
                           HorizontalTextAlignment="End"
                           VerticalOptions="Center"
                           TextColor="Black"/>

                    <!-- Tax -->
                    <Label Grid.Row="1"
                           Grid.Column="0"
                           x:Name="taxLabelTitle"
                           Text=""
                           FontSize="14"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           TextColor="Black"/>

                    <Label Grid.Row="1"
                           Grid.Column="1"
                           x:Name="taxLabel"
                           Text="$0.00"
                           FontSize="14"
                           HorizontalTextAlignment="End"
                           VerticalOptions="Center"
                           TextColor="Black"/>

                    <Label Grid.Row="2"
                           Grid.Column="0"
                           x:Name="taxWaiterLabelTitle"
                           Text="Propina Mesero:"
                           FontSize="14"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           TextColor="Black"/>

                    <Label Grid.Row="2"
                           Grid.Column="1"
                           x:Name="taxWaiterLabel"
                           Text="$0.00"
                           FontSize="14"
                           HorizontalTextAlignment="End"
                           VerticalOptions="Center"
                           TextColor="Black"/>

                    <!-- Discount -->
                    <Label Grid.Row="3"
                           Grid.Column="0"
                           Text="Descuento:"
                           FontSize="14"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           TextColor="Black"/>
                    <Entry Grid.Row="3"
                           Grid.Column="1"
                           x:Name="discountEntry"
                           Text=""
                           Placeholder="0"
                           FontSize="14"
                           HorizontalTextAlignment="End"
                           Keyboard="Numeric"
                           WidthRequest="100"
                           HeightRequest="10"
                           HorizontalOptions="End"
                           BackgroundColor="Transparent"
                           TextColor="Black"
                           TextChanged="OnDiscountChanged"/>

                    <!-- Separator Line -->
                    <BoxView Grid.Row="4"
                             Grid.ColumnSpan="2"
                             Color="#E9ECEF"
                             HeightRequest="1"
                             Margin="0,10"/>

                    <!-- Total -->
                    <Label Grid.Row="5"
                           Grid.Column="0"
                           Text="Total:"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#007bff"
                           VerticalOptions="Center"/>
                    <Label Grid.Row="5"
                           Grid.Column="1"
                           x:Name="totalLabel"
                           Text="$0.00"
                           FontSize="28"
                           FontAttributes="Bold"
                           TextColor="#007bff"
                           HorizontalTextAlignment="End"
                           VerticalOptions="Center"/>

                    <!-- Action Buttons -->
                    <HorizontalStackLayout  Grid.Row="6"
                                            Grid.ColumnSpan="2"
                                            Spacing="15"
                                            HorizontalOptions="Center"
                                            VerticalOptions="Center"
                                            Margin="0,15,0,0">

                        <Button x:Name="exitSaveButton"
                                Text="Salir y Guardar"
                                BackgroundColor="#C7CFDD"
                                TextColor="Black"
                                Clicked="OnExitSave"
                                FontSize="14"
                                WidthRequest="150"
                                HeightRequest="45"
                                CornerRadius="8"
                                FontAttributes="Bold">


                        </Button>

                        <Button x:Name="printReceiptButton"
                                Text="Imprimir Recibo"
                                BackgroundColor="#005F8C"
                                TextColor="White"
                                Clicked="OnPrintReceipt"
                                FontSize="14"
                                WidthRequest="200"
                                HeightRequest="45"
                                CornerRadius="8"
                                FontAttributes="Bold"/>
                    </HorizontalStackLayout>
                </Grid>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
